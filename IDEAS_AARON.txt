#!/bin/bash

# Archivo de configuración inicial
CONFIG_FILE="config.yml"

# Leer el archivo de configuración
jobs=$(awk '/jobs:/,0' $CONFIG_FILE)

# Extraer y procesar cada job
while IFS= read -r line; do
  if [[ $line =~ -[[:space:]]name:[[:space:]]\"([^\"]+)\" ]]; then
    job_name="${BASH_REMATCH[1]}"
  elif [[ $line =~ [[:space:]]*version:[[:space:]]\"([^\"]+)\" ]]; then
    version="${BASH_REMATCH[1]}"
  elif [[ $line =~ [[:space:]]*jira_id:[[:space:]]\"([^\"]+)\" ]]; then
    jira_id="${BASH_REMATCH[1]}"
    
    # Crear archivo .yml para el job actual
    job_file="${job_name}.yml"
    echo "version: \"$version\"" > $job_file
    echo "Archivo $job_file creado con version $version"

    # Resetear variables para el siguiente job
    job_name=""
    version=""
    jira_id=""
  fi
done <<< "$jobs"
