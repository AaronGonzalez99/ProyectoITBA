#!/bin/bash

# Archivo de configuraciÃ³n inicial
CONFIG_FILE="config.yml"

# Asegurarnos de que el archivo existe
if [[ ! -f $CONFIG_FILE ]]; then
  echo "El archivo $CONFIG_FILE no existe."
  exit 1
fi

# Leer el archivo y procesar cada job
current_job_name=""
current_version=""
current_jira_id=""

while IFS= read -r line; do
  if [[ $line =~ name:\ \"([^\"]+)\" ]]; then
    current_job_name="${BASH_REMATCH[1]}"
  elif [[ $line =~ version:\ \"([^\"]+)\" ]]; then
    current_version="${BASH_REMATCH[1]}"
  elif [[ $line =~ jira_id:\ \"([^\"]+)\" ]]; then
    current_jira_id="${BASH_REMATCH[1]}"
    
    # Crear archivo .yml para el job actual
    if [[ -n $current_job_name && -n $current_version && -n $current_jira_id ]]; then
      job_file="${current_job_name}.yml"
      echo "version: \"$current_version\"" > "$job_file"
      echo "Archivo $job_file creado con version $current_version"
      
      # Resetear variables para el siguiente job
      current_job_name=""
      current_version=""
      current_jira_id=""
    fi
  fi
done < "$CONFIG_FILE"
