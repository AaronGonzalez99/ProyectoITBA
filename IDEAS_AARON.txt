#!/bin/bash

# Archivo de configuración inicial
CONFIG_FILE="config.yml"

# Leer el archivo de configuración y procesar cada job
awk '/- name:/{flag=1;next}/^$/{flag=0}flag' $CONFIG_FILE | while read -r line; do
  if [[ $line =~ name:\ \"([^\"]+)\" ]]; then
    job_name="${BASH_REMATCH[1]}"
  elif [[ $line =~ version:\ \"([^\"]+)\" ]]; then
    version="${BASH_REMATCH[1]}"
  elif [[ $line =~ jira_id:\ \"([^\"]+)\" ]]; then
    jira_id="${BASH_REMATCH[1]}"
    
    # Crear archivo .yml para el job actual
    job_file="${job_name}.yml"
    echo "version: \"$version\"" > "$job_file"
    echo "Archivo $job_file creado con version $version"

    # Resetear variables para el siguiente job
    job_name=""
    version=""
    jira_id=""
  fi
done
